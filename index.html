<!doctype html>
<html lang="fi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>Ruokasi</title>
  <link rel="manifest" href="manifest.json" />
  <link rel="apple-touch-icon" href="icon.png" />
  <meta name="theme-color" content="#0A84FF" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="default" />
  <meta name="apple-mobile-web-app-title" content="Ruokasi" />
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <header class="nav">
    <div class="nav__title">
      <div class="appmark" aria-hidden="true"></div>
      <div>
        <h1>Ruokasi</h1>
        <div class="badge" id="versionBadge">‚Äì</div>
        <p class="sub">1900‚Äì2000 kcal / p√§iv√§ ‚Ä¢ v3.3.0.0</p>
      </div>
    </div>
    <div class="row row--tight" style="gap:8px">
      <button class="ghost" id="btnCalendar" title="Vaihda p√§iv√§" aria-label="Vaihda p√§iv√§">
        üìÖ
      </button>
      <button class="ghost" id="btnReset" title="Nollaa p√§iv√§n kirjaukset">Nollaa</button>
    </div>
  </header>

  <main class="container">

    <section class="card" id="secToday">
      <div class="row">
        <div>
          <h2>Sy√∂ty t√§n√§√§n</h2>
          <p class="muted" id="todayLabel">‚Äì</p>
        </div>
        <div class="pill" id="statusPill">OK</div>
      </div>

      <div class="kpi-ring">
        <div class="ring" id="mealRing" role="button" tabindex="0" aria-label="Aterioiden jakauma"></div>
        <div class="kpi-center">
          <div class="kpi__label">Kalorit</div>
          <div class="kpi__value"><span id="kcalEaten">0</span><span class="unit">kcal</span></div>
          <div class="muted" style="font-size:12px">J√§ljell√§ <span id="kcalLeft">0</span> kcal</div>
        </div>
      </div>

      <div class="kpi-grid" style="margin-top:12px">
        <div class="kpi">
          <div class="kpi__label">Arvioitu kulutus</div>
          <div class="kpi__value"><span id="kcalBurn">0</span><span class="unit">kcal</span></div>
        </div>
        <div class="kpi">
          <div class="kpi__label">P√§iv√§</div>
          <div class="kpi__value" style="font-size:18px"><span id="dayPretty">‚Äì</span></div>
        </div>
        <div class="kpi">
          <div class="kpi__label">Tila</div>
          <div class="kpi__value" style="font-size:18px"><span id="dayState">Tallennettu</span></div>
        </div>
      </div>

      <div class="macro-grid">
        <div class="macro">
          <div class="macro__top">
            <span>Proteiini</span><span class="muted"><span id="pNow">0</span> / <span id="pGoal">140</span> g</span>
          </div>
          <div class="bar bar--seg" id="pBar" role="button" tabindex="0" aria-label="Proteiinin jakauma"></div>
        </div>
        <div class="macro">
          <div class="macro__top">
            <span>Hiilarit</span><span class="muted"><span id="cNow">0</span> / <span id="cGoal">170</span> g</span>
          </div>
          <div class="bar bar--seg" id="cBar" role="button" tabindex="0" aria-label="Hiilarien jakauma"></div>
        </div>
        <div class="macro">
          <div class="macro__top">
            <span>Rasva</span><span class="muted"><span id="fNow">0</span> / <span id="fGoal">70</span> g</span>
          </div>
          <div class="bar bar--seg" id="fBar" role="button" tabindex="0" aria-label="Rasvan jakauma"></div>
        </div>
      </div>

      <details class="details" style="margin-top:12px">
        <summary>Lis√§asetukset</summary>
        <div class="form-grid">
          <label>Kaloritavoite (max)<input type="number" id="goalMax" value="2000" /></label>
          <label>Kaloritavoite (min)<input type="number" id="goalMin" value="1900" /></label>
          <label>Proteiinitavoite (g)<input type="number" id="goalP" value="140" /></label>
          <label>Hiilaritavoite (g)<input type="number" id="goalC" value="170" /></label>
          <label>Rasvatavoite (g)<input type="number" id="goalF" value="70" /></label>
          <label>Askeleet t√§n√§√§n<input type="number" id="steps" value="0" /></label>
          <label>Treeni (kcal)<input type="number" id="workoutKcal" value="0" /></label>
          <label>Uni (tunnit)<input type="number" id="sleepH" value="0" /></label>
        </div>
        <p class="hint">Askeleet arvioidaan ~0.04 kcal/askel. (Watch/uni automaattisesti vaatii natiivin iOS-sovelluksen.)</p>
      </details>
    </section>

    <details class="card carddet" open id="secAdd">
      <summary class="cardSum">Lis√§√§ ruokaa</summary>

      <div class="row">
        <div class="seg" id="mealSeg">
          <button class="seg__btn is-on" data-meal="aamiainen">Aamiainen</button>
          <button class="seg__btn" data-meal="lounas">Lounas</button>
          <button class="seg__btn" data-meal="v√§lipala">V√§lipala</button>
          <button class="seg__btn" data-meal="p√§iv√§llinen">P√§iv√§llinen</button>
          <button class="seg__btn" data-meal="iltapala">Iltapala</button>
        </div>
      </div>

      <div id="productList" class="list"></div>
    </details>

    <details class="card carddet" open id="secCustom">
      <summary class="cardSum">Tuotteet</summary>
      <div class="row">
        <div class="muted">Lis√§√§ tuotteita (OFF tai itse luotu). Kaikki tuotteet ovat samanarvoisia.</div>
        <button class="ghost" id="btnOpenCustom">Lis√§√§ tuote</button>
      </div>
    </details>

    <details class="card carddet" open id="secLog">
      <summary class="cardSum">P√§iv√§n sy√∂miset</summary>
      <div class="row">
        <div class="muted">Kirjaukset valitulle p√§iv√§lle.</div>
        <button class="ghost" id="btnExport">Vie</button>
      </div>
      <div id="logList" class="log"></div>
    </details>

    <details class="card carddet" open id="secSuggest">
      <summary class="cardSum">Suositus</summary>
      <div class="muted">Suositus tasapainottaa p√§iv√§n makroja. Suosikit priorisoidaan, jos ne t√§sm√§√§v√§t tarpeeseen.</div>
      <div class="mealplan" id="mealPlan"></div>
      <div class="row row--tight" style="margin-top:10px">
        <button class="ghost" id="btnSuggest">P√§ivit√§</button>
        <div class="muted" id="suggestUpdated" style="margin-left:auto">‚Äì</div>
      </div>
      <div class="suggest" id="suggestBox">‚Äì</div>
    </details>

  </main>

  <!-- Product card modal -->
  <div class="modalOverlay is-hidden" id="productModal" role="dialog" aria-modal="true" aria-labelledby="productTitle">
    <div class="modal">
      <div class="modal__head">
        <h3 id="productTitle">Tuote</h3>
        <button class="ghost" type="button" id="btnCloseProduct" aria-label="Sulje">‚úï</button>
      </div>

      <div class="productHero" style="margin-top:10px">
        <img id="pmImg" alt="" class="productImg is-hidden" />
        <div style="min-width:0">
          <div class="row" style="align-items:flex-start">
            <div style="min-width:0">
              <div class="productName">
                <button class="heart" id="pmHeart" type="button" aria-label="Suosikki">ü§ç</button>
                <span id="pmName">‚Äì</span>
              </div>
              <div class="muted" style="font-size:12px;margin-top:4px" id="pmMeta">‚Äì</div>
            </div>
            <div class="pill" id="pmNew" style="display:none">UUTUUS</div>
          </div>

          <div class="stepper" style="margin-top:10px">
            <button class="stepper__btn" type="button" id="pmDec" aria-label="miinus">‚àí</button>
            <div class="minirow stepper__mid">
              <div class="qty"><span id="pmUnits">1</span> <span id="pmUnit">annos</span></div>
              <div class="totalsline"><span id="pmGrams">0</span> g</div>
            </div>
            <button class="stepper__btn" type="button" id="pmInc" aria-label="plus">+</button>
          </div>

          <div class="totalsline" style="margin-top:10px">
            <strong><span id="pmKcal">0</span></strong> kcal ‚Ä¢ P <span id="pmP">0</span> ‚Ä¢ H <span id="pmC">0</span> ‚Ä¢ R <span id="pmF">0</span>
          </div>
        </div>
      </div>

      <div class="row row--tight" style="margin-top:14px">
        <button class="ghost" type="button" id="pmEdit">Muokkaa</button>
        <button class="primary" type="button" id="pmAccept">V</button>
        <button class="ghost" type="button" id="pmCancel">X</button>
      </div>

      <div id="pmEditArea" class="is-hidden" style="margin-top:12px">
        <div class="form-grid">
          <label>Nimi<input id="pmEName" /></label>
          <label>Kategoria<input id="pmECat" list="catList" /></label>
          <label>Kalorit / 100g<input id="pmEKcal" type="number" /></label>
          <label>Proteiini / 100g<input id="pmEP" type="number" /></label>
          <label>Hiilarit / 100g<input id="pmEC" type="number" /></label>
          <label>Rasva / 100g<input id="pmEF" type="number" /></label>
          <label>Yksikk√∂<input id="pmEUnit" placeholder="g, kg, annos, kpl, dl" /></label>
          <label>g / yksikk√∂<input id="pmEGPU" type="number" /></label>
          <label>EAN<input id="pmEEAN" inputmode="numeric" placeholder="viivakoodi (valinnainen)" /></label>
          <label>Kuva-URL<input id="pmEImg" placeholder="valinnainen" /></label>
        </div>
        <div class="row row--tight" style="margin-top:12px">
          <button class="primary" type="button" id="pmSaveEdit">Tallenna</button>
          <button class="ghost" type="button" id="pmCancelEdit">Peruuta</button>
        </div>
      </div>

      <datalist id="catList"></datalist>
    </div>
  </div>

  <!-- Add product modal (OFF + manual) -->
  <div class="modalOverlay is-hidden" id="customModal" role="dialog" aria-modal="true" aria-labelledby="customTitle">
    <div class="modal">
      <div class="modal__head">
        <h3 id="customTitle">Lis√§√§ tuote</h3>
        <button class="ghost" type="button" id="btnCloseCustom" aria-label="Sulje">‚úï</button>
      </div>

      <details class="details" style="margin-top:10px">
        <summary>Hae Open Food Factsista</summary>
        <div class="form-grid" style="margin-top:10px">
          <label>Haku (tuotenimi tai viivakoodi)
            <input id="offQuery" placeholder="esim. Valio PROfeel / 6408432101234" />
          </label>
        </div>
        <div class="row row--tight" style="margin-top:10px">
          <button class="ghost" type="button" id="btnOffSearch">Hae</button>
          <div class="muted" id="offStatus" style="margin-left:auto">‚Äì</div>
        </div>
        <div id="offResults" class="list" style="margin-top:10px"></div>
        <p class="hint">L√§hde: Open Food Facts (avoin tietokanta). Tarkista arvot, jos tiedoissa on puutteita.</p>
      </details>

      <div class="form-grid" style="margin-top:12px">
        <label>Nimi<input id="cfName" /></label>
        <label>Kategoria<input id="cfCat" list="catList2" placeholder="aamiainen, lounas‚Ä¶" /></label>
        <label>Kalorit / 100g<input id="cfKcal" type="number" /></label>
        <label>Proteiini / 100g<input id="cfP" type="number" /></label>
        <label>Hiilarit / 100g<input id="cfC" type="number" /></label>
        <label>Rasva / 100g<input id="cfF" type="number" /></label>
        <label>Yksikk√∂<input id="cfUnit" placeholder="g, kg, annos, kpl, dl" /></label>
        <label>g / yksikk√∂<input id="cfGPU" type="number" placeholder="35" /></label>
        <label>EAN<input id="cfEAN" inputmode="numeric" placeholder="valinnainen" /></label>
        <label>Kuva-URL<input id="cfImg" placeholder="valinnainen" /></label>
      </div>

      <div class="row row--tight" style="margin-top:12px">
        <button class="primary" type="button" id="btnSaveCustom">Tallenna</button>
        <button class="ghost" type="button" id="btnCancelCustom">Peruuta</button>
      </div>

      <datalist id="catList2"></datalist>
    </div>
  </div>

  <!-- Day picker modal -->
  <div class="modalOverlay is-hidden" id="dayModal" role="dialog" aria-modal="true" aria-labelledby="dayTitle">
    <div class="modal">
      <div class="modal__head">
        <h3 id="dayTitle">Vaihda p√§iv√§</h3>
        <button class="ghost" type="button" id="btnCloseDay" aria-label="Sulje">‚úï</button>
      </div>
      <div class="form-grid" style="margin-top:12px">
        <label>P√§iv√§m√§√§r√§
          <input id="dayPicker" type="date" />
        </label>
      </div>
      <div class="row row--tight" style="margin-top:12px">
        <button class="primary" type="button" id="btnToday">T√§n√§√§n</button>
        <button class="ghost" type="button" id="btnDayApply">Valitse</button>
      </div>
      <p class="hint">Voit palata menneisiin p√§iviin ja kirjata takautuvasti.</p>
    </div>
  </div>

  <!-- Save changes confirm -->
  <div class="modalOverlay is-hidden" id="saveConfirmModal" role="dialog" aria-modal="true" aria-labelledby="saveTitle">
    <div class="modal">
      <div class="modal__head">
        <h3 id="saveTitle">Tallennetaanko muutokset t√§lle p√§iv√§lle?</h3>
        <button class="ghost" type="button" id="btnCloseSaveConfirm" aria-label="Sulje">‚úï</button>
      </div>
      <p class="muted" id="saveConfirmDay" style="margin-top:10px">P√§iv√§: ‚Äì</p>
      <div class="row row--tight" style="margin-top:12px">
        <button class="primary" type="button" id="btnSaveYes">Tallenna</button>
        <button class="ghost" type="button" id="btnSaveNo">√Ñl√§ tallenna</button>
        <button class="ghost" type="button" id="btnSaveCancel">Peruuta</button>
      </div>
    </div>
  </div>

  <!-- Breakdown modal -->
  <div class="modalOverlay is-hidden" id="breakdownModal" role="dialog" aria-modal="true" aria-labelledby="breakTitle">
    <div class="modal">
      <div class="modal__head">
        <h3 id="breakTitle">Ateriat</h3>
        <button class="ghost" type="button" id="btnCloseBreak" aria-label="Sulje">‚úï</button>
      </div>
      <div id="breakdownBody" style="margin-top:12px"></div>
      <div class="row row--tight" style="margin-top:12px">
        <button class="ghost" type="button" id="btnBreakClose">X</button>
      </div>
    </div>
  </div>

<script src="app.js"></script>
</body>
</html>
